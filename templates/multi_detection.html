<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Detection - DeepVysion+</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new_styles.css') }}">
</head>
<body>
    <header>
        <div id="navbar-placeholder"></div>
    </header>
    <div class="container">
        <div class="header">    
            <h1 class="title">Try Multi-Detection</h1>
            <p class="subtitle">Analyze videos using multiple detection models, all in one place. <br>(Do take note that it will take a while to run)</p>
        </div>

        <div class="form-card">
            <form id="uploadForm" method="POST" enctype="multipart/form-data">
                <div class="methods-section-multi">
                    <h2 class="section-title">Select Detection Methods</h2>
                    <div class="methods-grid-multi">
                        <div class="method-card-multi" data-method="deep_learning">
                            <input type="checkbox" name="methods" value="deep_learning" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üß†</div>
                                <div class="method-info">
                                    <h3>Deep Learning</h3>
                                    <p>Neural network-based pattern recognition</p>
                                </div>
                            </div>
                        </div>

                        <div class="method-card-multi" data-method="physiological">
                            <input type="checkbox" name="methods" value="physiological" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üíì</div>
                                <div class="method-info">
                                    <h3>Physiological Analysis</h3>
                                    <p>Uses rPPG to detect abnormal physiological signals</p>
                                </div>
                            </div>
                        </div>

                        <div class="method-card-multi" data-method="body_posture">
                            <input type="checkbox" name="methods" value="body_posture" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üö∂</div>
                                <div class="method-info">
                                    <h3>Body Posture Analysis</h3>
                                    <p>Posture analysis to identify inconsistent body motion</p>
                                </div>
                            </div>
                        </div>

                        <div class="method-card-multi" data-method="visual_artifacts">
                            <input type="checkbox" name="methods" value="visual_artifacts" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üëÅÔ∏è</div>
                                <div class="method-info">
                                    <h3>Visual Artifacts</h3>
                                    <p>Detects inconsistent facial features and artifacts</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="upload-section">
                    <h2 class="section-title">Upload Video File</h2>
                    <div class="dropbox" id="dropbox">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Drag & drop your video file here</div>
                        <div class="upload-subtext">or click to select from your device</div>
                        <input type="file" name="file" id="file" accept="video/*" class="file-input" required>
                        <video id="video-preview" class="video-preview" controls></video>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitButton">
                    Start Analysis
                </button>

                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <div class="processing-text">Processing your video (it may take a few minutes)...</div>
                </div>
            </form>
            <br><br>
            <!-- Video URL Submission Method -->
            <div class="detection-method dvurl-method">
                <div class="method-header">
                    <div class="method-icon-try">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                            <!-- Link/URL Icon -->
                            <path d="M17 7a5 5 0 0 1 0 7l-1 1m-4-1a5 5 0 1 1 0-7l1-1" stroke="#764ba2" stroke-width="2"/>
                            <path d="M8 16a6 6 0 1 1 8 0M8 8a6 6 0 0 1 8 8" stroke="#667eea" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="method-text">
                        <h2 class="method-title">Submit Video URL</h2>
                        <p class="method-description">
                            Paste a YouTube, Twitter, or TikTok video link.<br>
                            <b>Only public and short videos are accepted (max 30 seconds).</b>
                        </p>
                    </div>
                </div>
                <form id="dvurl-form" class="dvurl-form" method="POST" action="/multi_detection" autocomplete="off" style="display: flex; flex-direction: column; gap: 2rem;">
                    <div class="dvurl-input-container">
                        <input type="url" name="video_url" id="dvurl-input" class="dvurl-input" 
                            placeholder="Paste video URL (e.g. https://...)" 
                            pattern="https?://.*" required 
                            style="width: 100%; padding: 1rem 1.2rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--card-bg); color: var(--text-primary); font-size: 1.1rem;">
                        <span class="dvurl-hint">Supports YouTube, Twitter, TikTok, and other public video links.</span>
                    </div>
                    <div style="display: flex; gap: 1.5rem; align-items: center;">
                        <button type="submit" id="dvurl-submit" class="analyze-button dvurl-submit">
                            <span>Analyze URL</span>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M5 12h14m-7-7l7 7-7 7" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </button>
                    </div>
                    <div id="dvurl-loading" class="loading-spinner dvurl-loading" style="display: none;">
                        <div class="spinner-container"><div class="spinner"></div></div>
                        <div class="loading-text">
                            <h4>Fetching & Processing video...</h4>
                            <p>Please <b>do not</b> refresh or leave this page.</p>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById("uploadForm");
            const submitButton = document.getElementById("submitButton");
            const spinner = document.getElementById("loadingSpinner");
            const dropbox = document.getElementById("dropbox");
            const fileInput = document.getElementById("file");
            const videoPreview = document.getElementById("video-preview");
            const methodCards = document.querySelectorAll(".method-card-multi");

            // Method selection handling
            methodCards.forEach(card => {
                card.addEventListener("click", function() {
                    const checkbox = this.querySelector(".method-checkbox");
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        this.classList.add("selected");
                    } else {
                        this.classList.remove("selected");
                    }
                });
            });

            // File upload handling
            dropbox.addEventListener("click", () => fileInput.click());

            dropbox.addEventListener("dragover", (e) => {
                e.preventDefault();
                dropbox.classList.add("dragover");
            });

            dropbox.addEventListener("dragleave", () => {
                dropbox.classList.remove("dragover");
            });

            dropbox.addEventListener("drop", (e) => {
                e.preventDefault();
                dropbox.classList.remove("dragover");
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            fileInput.addEventListener("change", (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            function handleFileSelect(file) {
                if (file.type.startsWith("video/")) {
                    const url = URL.createObjectURL(file);
                    videoPreview.src = url;
                    videoPreview.style.display = "block";
                    
                    dropbox.style.padding = "1rem";
                    dropbox.querySelector(".upload-icon").style.display = "none";
                    dropbox.querySelector(".upload-text").textContent = `Selected: ${file.name}`;
                    dropbox.querySelector(".upload-subtext").textContent = "Click to change file";
                }
            }

            // Form submission
            form.addEventListener("submit", function(event) {
                event.preventDefault();

                const selectedMethods = document.querySelectorAll("input[name='methods']:checked");
                if (selectedMethods.length === 0) {
                    alert("üö® Please select at least one detection method to proceed!");
                    return;
                }

                if (!fileInput.files.length) {
                    alert("üìÅ Please upload a video file!");
                    return;
                }

                // Start processing animation
                submitButton.disabled = true;
                submitButton.innerHTML = "üîÑ Processing...";
                spinner.style.display = "block";

                // Simulate form submission (replace with actual submission logic)
                setTimeout(() => {
                    form.setAttribute("action", "/multi_detection");
                    form.setAttribute("method", "POST");
                    form.submit();
                }, 1000);
            });
        });
        document.addEventListener("DOMContentLoaded", function() {
            let dvurlForm = document.getElementById("dvurl-form");
            let dvurlLoading = document.getElementById("dvurl-loading");
            let dvurlSubmit = document.getElementById("dvurl-submit");

            if (dvurlForm) {
                dvurlForm.addEventListener("submit", function(event) {
                    dvurlSubmit.disabled = true;
                    dvurlSubmit.innerHTML = "Processing...";
                    dvurlLoading.style.display = "block";
                });
            }
        });
    </script>
    <script src="../static/js/scripts.js"></script>
</body>
</html>