<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Detection - DeepVysion+</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new_styles.css') }}">
</head>
<body>
    <header>
        <div id="navbar-placeholder"></div>
    </header>
    <div class="container">
        <div class="header">    
            <h1 class="title">Try Multi-Detection</h1>
            <p class="subtitle">Analyze videos using multiple detection models, all in one place. <br>(Do take note that it will take a while to run)</p>
        </div>

        <div class="form-card">
            <form id="multiUploadForm" method="POST" enctype="multipart/form-data" action="/multi_detection">
                <div class="methods-section-multi">
                    <h2 class="section-title">Select Detection Methods</h2>
                    <div class="methods-grid-multi">
                        <div class="method-card-multi" data-method="deep_learning">
                            <input type="checkbox" name="methods" value="deep_learning" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üß†</div>
                                <div class="method-info">
                                    <h3>Deep Learning</h3>
                                    <p>Neural network-based pattern recognition</p>
                                </div>
                            </div>
                        </div>
                        <div class="method-card-multi" data-method="physiological">
                            <input type="checkbox" name="methods" value="physiological" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üíì</div>
                                <div class="method-info">
                                    <h3>Physiological Analysis</h3>
                                    <p>Uses rPPG to detect abnormal physiological signals</p>
                                </div>
                            </div>
                        </div>
                        <div class="method-card-multi" data-method="body_posture">
                            <input type="checkbox" name="methods" value="body_posture" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üö∂</div>
                                <div class="method-info">
                                    <h3>Body Posture Analysis</h3>
                                    <p>Posture analysis to identify inconsistent body motion</p>
                                </div>
                            </div>
                        </div>
                        <div class="method-card-multi" data-method="visual_artifacts">
                            <input type="checkbox" name="methods" value="visual_artifacts" class="method-checkbox">
                            <div class="method-content">
                                <div class="method-icon-multi">üëÅÔ∏è</div>
                                <div class="method-info">
                                    <h3>Visual Artifacts</h3>
                                    <p>Detects inconsistent facial features and artifacts</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="upload-section">
                    <h2 class="section-title">Upload Video File</h2>
                    <div class="dropbox" id="dropbox">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Drag & drop your video file here</div>
                        <div class="upload-subtext">or click to select from your device</div>
                        <input type="file" name="file" id="file" accept="video/*" class="file-input">
                        <video id="video-preview" class="video-preview" controls></video>
                    </div>
                    <h2 class="section-title" style="margin-top:3rem; margin-bottom: 1rem">Submit Video URL</h2>
                    <div class="dvurl-input-container">
                        <input type="url" name="video_url" id="dvurl-input" class="dvurl-input"
                            placeholder="Paste video URL (e.g. https://...)"
                            pattern="https?://.*"
                            style="width:100%; padding:1rem 1.2rem; border-radius:12px; border:1px solid var(--glass-border); background:var(--card-bg); color:var(--text-primary); font-size:1.1rem;">
                        <span class="dvurl-hint">Supports YouTube, Twitter, TikTok, and other public video links.</span>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitButton" style="margin-top: 3rem;">Start Analysis</button>
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <div class="processing-text">Processing your video (it may take a few minutes)...</div>
                </div>
            </form>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById("multiUploadForm");
        const submitButton = document.getElementById("submitButton");
        const spinner = document.getElementById("loadingSpinner");
        const fileInput = document.getElementById("file");
        const videoUrlInput = document.getElementById("dvurl-input");
        const methodCards = document.querySelectorAll(".method-card-multi");

        // Method selection UI
        methodCards.forEach(card => {
            card.addEventListener("click", function() {
                const checkbox = this.querySelector(".method-checkbox");
                checkbox.checked = !checkbox.checked;
                this.classList.toggle("selected", checkbox.checked);
            });
        });

        // Unified form submission
        form.addEventListener("submit", function(event) {
            // Prevent default first
            event.preventDefault();

            // Validate methods
            const selectedMethods = document.querySelectorAll("input[name='methods']:checked");
            if (selectedMethods.length === 0) {
                alert("üö® Please select at least one detection method to proceed!");
                return;
            }

            // Validate at least one source
            const fileProvided = fileInput && fileInput.files.length > 0;
            const urlProvided = videoUrlInput && videoUrlInput.value.trim().length > 0;
            if (!fileProvided && !urlProvided) {
                alert("üìÅ Please upload a video file or paste a video URL!");
                return;
            }
            if (fileProvided && urlProvided) {
                alert("Please provide only one source: either upload a file OR paste a URL, not both.");
                return;
            }

            // Show loading spinner, lock submit
            submitButton.disabled = true;
            submitButton.innerHTML = "üîÑ Processing...";
            spinner.style.display = "block";

            setTimeout(() => {
                form.submit();
            }, 1000);
        });
    });
    </script>
    <script src="../static/js/scripts.js"></script>
</body>
</html>